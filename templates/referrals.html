<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hospital System Integration</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/referall_style.css" />
  </head>

  <body>
    <div class="container">
      <div class="card">
        <h2>Hospital Registration</h2>
        <form id="hospitalForm">
          <div class="form-grid">
            <div style="grid-column: span 2">
              <label>Name</label>
              <input type="text" id="hid" placeholder="Hospital id" />
            </div>
            <div>
              <label>City</label>
              <input type="text" id="city" placeholder="Anantpur" />
            </div>
            <div>
              <label>State</label>
              <input type="text" id="state" placeholder="Andhra Pradesh" />
            </div>
            <div>
              <label>Specialisation</label>
              <input type="text" id="spec" placeholder="Pediatrics" />
            </div>
            <div>
              <label>Rating</label>
              <input type="number" id="rate" step="0.1" placeholder="4.1" />
            </div>
            <div>
              <label>Beds</label>
              <input type="number" id="beds" placeholder="19" />
            </div>
            <div style="grid-column: span 2">
              <label>Insurance</label>
              <input type="text" id="ins" placeholder="CGHS, AB-PMJAY" />
            </div>
          </div>

          <!-- Hidden fields ‚Äî filled automatically by geolocation -->
          <input type="hidden" id="lat" />
          <input type="hidden" id="lng" />

          <!-- Location status pill -->
          <div
            id="locationStatus"
            style="
              margin: 14px 0 4px;
              padding: 8px 12px;
              border-radius: 6px;
              font-size: 0.82rem;
              display: flex;
              align-items: center;
              gap: 8px;
            "
          >
            <span id="locationIcon">‚è≥</span>
            <span id="locationText">Fetching your location‚Ä¶</span>
          </div>

          <button type="submit" id="submitBtn" disabled>
            <a href="hospital_results.html">REGISTER</a>
          </button>
        </form>

        <div id="responseBox">
          <strong>Server Response:</strong>
          <p id="responseText"></p>
        </div>
      </div>
    </div>

    <script>
      // ‚îÄ‚îÄ Auto-fetch location on page load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const locationStatus = document.getElementById("locationStatus");
      const locationIcon = document.getElementById("locationIcon");
      const locationText = document.getElementById("locationText");
      const submitBtn = document.getElementById("submitBtn");

      function setStatus(type, message) {
        const styles = {
          loading: {
            bg: "#f0f4ff",
            color: "#3a5bd9",
            border: "#c7d4f7",
            icon: "‚è≥",
          },
          success: {
            bg: "#f0faf4",
            color: "#1a6644",
            border: "#b2dfc5",
            icon: "üìç",
          },
          error: {
            bg: "#fff3f2",
            color: "#b33a2a",
            border: "#f5c2bb",
            icon: "‚ö†Ô∏è",
          },
        };
        const s = styles[type];
        locationStatus.style.background = s.bg;
        locationStatus.style.color = s.color;
        locationStatus.style.border = `1px solid ${s.border}`;
        locationIcon.textContent = s.icon;
        locationText.textContent = message;
      }

      if (navigator.geolocation) {
        setStatus("loading", "Fetching your location‚Ä¶");
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude.toFixed(6);
            const lng = pos.coords.longitude.toFixed(6);
            document.getElementById("lat").value = lat;
            document.getElementById("lng").value = lng;
            setStatus("success", `Location captured ‚Äî ${lat}¬∞N, ${lng}¬∞E`);
            submitBtn.disabled = false;
          },
          (err) => {
            const messages = {
              1: "Location access denied. Please allow location in your browser.",
              2: "Location unavailable. Check your device settings.",
              3: "Location request timed out. Please refresh and try again.",
            };
            setStatus("error", messages[err.code] || "Could not get location.");
            // Still allow submit ‚Äî lat/lng will be empty and backend can handle it
            submitBtn.disabled = false;
          },
          { enableHighAccuracy: true, timeout: 10000 },
        );
      } else {
        setStatus("error", "Geolocation is not supported by your browser.");
        submitBtn.disabled = false;
      }
    </script>

    <script src="../script/referall_script.js"></script>
  </body>
</html>
